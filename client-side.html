<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form id='message-form'>
        
        <input id='message-input'
            type="text" placeholder="Message"
            autofocus autocomplete="off" />
        <button type="submit">Send</button>
        <ul id="messages"></ul>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();

        // connection with server
        socket.on('connect', function () {
            console.log('Connected to Server');
        });

        // message listener from server
        socket.on('newMessage',
            function (message) {
                const li = document.createElement('li');
                li.textContent = `${message.from}: ${message.text} : ${message.createdAt}`;
                document.getElementById('messages').appendChild(li);
                console.log(message);
            });

        // add event listener to form
        document.getElementById('message-form')
            .addEventListener('submit',
                function (e) {
                    // prevent the form from submitting
                    e.preventDefault();

                    // emit message from user side
                    socket.emit('createMessage',
                        {
                            from:'user',
                            text: document.getElementById('message-input').value,
                            createdAt:new Date(Date.now()).toLocaleString()
                        });
                        document.getElementById('message-input').value = '';
                });

        // when disconnected from server
        socket.on('disconnect', function () {
            console.log('Disconnected from server');
        });
    </script>
</body>
</html>